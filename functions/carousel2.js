const { Markup } = require('telegraf');

// –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏
const createButton = (label, url = null, callbackData = null) => {
    const button = { text: label };
    if (url) {
        button.url = url;
    }
    if (callbackData) {
        button.callback_data = callbackData;
    }
    return button;
};

const createKeyboard = () => {
    const tours = [
        {
            title: '"–ö—Ä–∞–π –º–µ—á—Ç—ã" 3 –¥–Ω—è',
            description: '–¢—É—Ä, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã —Å–º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å –≥–ª–∞–≤–Ω—ã–µ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.',
            link: 'https://vk.com/market/product/kray-mechty-3-dnya-vse-vklyucheno-28295020-9825947',
            buttonLabel: 'üëâ –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ‚ú®',
            buttonCallback: 'tour_1'
        },
        {
            title: '"–í–µ—Å—å –î–∞–≥–µ—Å—Ç–∞–Ω" 5 –¥–Ω–µ–π',
            description: '–£–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π —Ç—É—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª–∏—Ç –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π.',
            link: 'https://vk.com/market/product/ves-dagestan-5-dney-vse-vklyucheno-28295020-4189351',
            buttonLabel: 'üëâ –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ‚ú®',
            buttonCallback: 'tour_2'
        },
        {
            title: '"–î–∞–≥–µ—Å—Ç–∞–Ω—Å–∫–∏–π –≤–æ—è–∂"',
            description: '–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ, –¥–ª–∏–Ω–æ–π –≤ –Ω–µ–¥–µ–ª—é. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –≤—Å–µ —Ü–≤–µ—Ç–∞ –î–∞–≥–µ—Å—Ç–∞–Ω–∞!',
            link: 'https://vk.com/market/product/quotdagestanskiy-voyazhquot-7-dney-vse-vklyucheno-28295020-9906226',
            buttonLabel: 'üëâ –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ‚ú®',
            buttonCallback: 'tour_3'
        }
    ];

    const keyboard = tours.map(tour => [
        {
            text: `${tour.title} - ${tour.description}`,
            callback_data: tour.buttonCallback
        },
        createButton(tour.buttonLabel, tour.link)
    ]);

    keyboard.push([
        createButton('üõë –ù–∞–∑–∞–¥', null, 'back')
    ]);

    return keyboard;
};

const carousel2 = (bot) => {
    bot.start((ctx) => {
    ctx.reply('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —Ç—É—Ä! ‚ú®\n\n' +
        '–ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –º–∞—Ä—à—Ä—É—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—Ç –≤–∞–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –∫—Ä–∞—Å–æ—Ç—É –∏ –∫—É–ª—å—Ç—É—Ä—É –î–∞–≥–µ—Å—Ç–∞–Ω–∞.\n' +
        '–û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç—É—Ä, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å/–Ω–∞–ø–∏—Å–∞—Ç—å/—Å–≤—è–∑–∞—Ç—å—Å—è).\n' +
        '–•–æ—Ç–∏—Ç–µ —Ç—É—Ä –Ω–∞ –¥—Ä—É–≥–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π? –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º!\n\n' +
        'üëá –ù–∏–∂–µ –≤—ã –Ω–∞–π–¥—ë—Ç–µ –Ω–∞—à –∫–∞—Ç–∞–ª–æ–≥ –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã—Ö —Ç—É—Ä–æ–≤:', {
        reply_markup: {
            inline_keyboard: keyboard
        }
    });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–ª–ª–±–µ–∫–æ–≤
bot.on('callback_query', (ctx) => {
    const callbackData = ctx.callbackQuery.data;
    
    if (callbackData === 'back') {
        const keyboard = createKeyboard();
        ctx.reply('–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —Ç—É—Ä! ‚ú®\n\n' +
            '–ú—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–∏ –º–∞—Ä—à—Ä—É—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—Ç –≤–∞–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –∫—Ä–∞—Å–æ—Ç—É –∏ –∫—É–ª—å—Ç—É—Ä—É –î–∞–≥–µ—Å—Ç–∞–Ω–∞.\n' +
            '–û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç—É—Ä, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å/–Ω–∞–ø–∏—Å–∞—Ç—å/—Å–≤—è–∑–∞—Ç—å—Å—è).\n' +
            '–•–æ—Ç–∏—Ç–µ —Ç—É—Ä –Ω–∞ –¥—Ä—É–≥–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π? –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º!\n\n' +
            'üëá –ù–∏–∂–µ –≤—ã –Ω–∞–π–¥—ë—Ç–µ –Ω–∞—à –∫–∞—Ç–∞–ª–æ–≥ –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã—Ö —Ç—É—Ä–æ–≤:', {
            reply_markup: {
                inline_keyboard: keyboard
            }
        });
    } else if (callbackData.startsWith('tour_')) {
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—É—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å)
        ctx.answerCallbackQuery();
        ctx.reply('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—É—Ä–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞ –∑–¥–µ—Å—å.');
    }
});
};

module.exports = { carousel2 };
